# 企业微信通知功能使用指南

## 功能概述

本项目集成了企业微信通知功能，可以在每次代码推送时自动发送通知到指定的企业微信群组，帮助团队成员及时了解项目变更情况。

## 配置步骤

### 1. 获取企业微信机器人 Webhook

1. 在企业微信中创建一个群聊
2. 添加 "群机器人"
3. 复制机器人的 Webhook URL

### 2. 配置环境变量

在 `backend/.env` 文件中添加以下配置：

```env
# 企业微信通知配置
WECOM_WEBHOOK_URL=https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=your-webhook-key
```

## 使用方法

### 1. 基础用法

```typescript
import WeComNotificationService from './src/services/WeComNotificationService';

// 创建服务实例
const notificationService = new WeComNotificationService({
  webhookUrl: process.env.WECOM_WEBHOOK_URL || ''
});

// 发送代码推送通知
const commitInfo = {
  message: '完善项目文档和结构',
  author: '张三',
  timestamp: '2024-01-15 10:30:00',
  hash: '8378c38',
  filesChanged: 4,
  insertions: 241,
  deletions: 95
};

notificationService.sendCodePushNotification(commitInfo)
  .then(() => console.log('通知发送成功'))
  .catch(error => console.error('通知发送失败:', error));
```

### 2. 自定义通知

```typescript
// 发送自定义通知
notificationService.sendCustomNotification(
  '🎉 项目里程碑完成',
  '核心功能已开发完成，即将进入测试阶段！\n\n- ✅ 前端界面完成\n- ✅ 后端API完成\n- ✅ 数据库设计完成'
);
```

## 集成到 Git Hook

可以将企业微信通知集成到 Git 的 post-commit 或 post-push 钩子中，实现自动通知功能。

### 创建 Git Hook 脚本

在项目根目录的 `.git/hooks` 文件夹下创建 `post-push` 文件：

```bash
#!/bin/sh

# 获取最新提交信息
COMMIT_MSG=$(git log -1 --pretty=%B)
COMMIT_AUTHOR=$(git log -1 --pretty=%an)
COMMIT_HASH=$(git log -1 --pretty=%h)
COMMIT_TIME=$(git log -1 --pretty=%cd)

# 构建通知
MESSAGE="\n**代码推送通知**\n\n提交信息：$COMMIT_MSG\n提交作者：$COMMIT_AUTHOR\n提交哈希：$COMMIT_HASH\n提交时间：$COMMIT_TIME\n"

# 发送到企业微信（通过 curl 调用）
WEBHOOK_URL="your-webhook-url"

curl "$WEBHOOK_URL" \
  -H "Content-Type: application/json" \
  -d '{"msgtype":"markdown","markdown":{"content":"'"$MESSAGE"'"}}'
```

### 赋予执行权限

```bash
chmod +x .git/hooks/post-push
```

## 注意事项

1. 请妥善保管你的企业微信机器人 Webhook URL，不要泄露给未授权人员
2. 通知频率不要过高，避免对团队成员造成打扰
3. 可以根据实际需求自定义通知内容和格式
4. 在生产环境中，建议通过 CI/CD 工具（如 GitHub Actions、GitLab CI）来集成通知功能