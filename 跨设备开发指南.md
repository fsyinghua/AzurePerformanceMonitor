# 📱 跨设备开发和 GitHub 同步指南

本指南详细说明如何在不同设备间同步 Azure Performance Monitor 项目代码，以及如何使用 GitHub 进行版本控制和 CI/CD 配置。

---

## 📋 基本信息

- 项目名称：Azure Performance Monitor
- 开发平台：Trae AI
- GitHub 仓库地址：**https://github.com/fsyinghua/AzurePerformanceMonitor.git**
- 最后更新时间：202X年X月X日
- 核心功能：Azure 云资源监控、FinOps 工具、企业微信通知、CI/CD 自动化

---

## 🔄 当前设备保存项目

### 保存变更到 GitHub
每次完成开发工作后，请及时保存和推送变更：

```bash
cd c:\Codes\AzurePerformanceMonitor

# 查看当前状态
git status

# 添加所有变更到暂存区
git add .

# 提交变更（请填写有意义的提交信息）
git commit -m "功能开发：完善企业微信通知集成"

# 推送到远程仓库
git push origin master
```

### 重要提醒
- 确保企业微信配置等敏感信息不被提交到 GitHub
- 使用 `.gitignore` 文件忽略 `.env` 等包含敏感信息的文件
- 每次推送前检查 `git status` 和 `git diff`

---

## 📥 新设备克隆项目

### 1. 克隆 GitHub 仓库
在新设备上获取完整项目：

```bash
git clone https://github.com/fsyinghua/AzurePerformanceMonitor.git
cd AzurePerformanceMonitor
```

### 2. 配置环境

#### 创建环境配置文件
```bash
cd backend
# 复制示例环境配置
copy .env.example .env
# 编辑 .env 文件，配置所需的环境变量
# 特别是企业微信 Webhook URL 等
```

#### 安装依赖
```bash
# 安装后端依赖
cd backend
npm install

# 安装前端依赖
cd ../frontend
npm install
```

#### 启动服务
```bash
# 启动后端服务
cd backend
npm run dev

# 启动前端应用（在新终端窗口）
cd frontend
npm run dev
```

- 后端服务运行于: `http://localhost:3000`
- 前端应用运行于: `http://localhost:5173`

---

## 🚀 新设备上恢复开发环境

### 1. 恢复 Trae AI 上下文
在新设备的 Trae AI 对话中恢复开发状态：
1. 打开项目根目录中的 `TRAE_AI_CONTEXT.md` 文件
2. 复制文件中的所有内容
3. 在新的 Trae AI 对话中粘贴并提交
4. Trae AI 将自动恢复到之前的开发状态

### 2. 配置企业微信通知（可选）
如果需要使用企业微信通知功能，请按以下步骤配置：

#### 本地环境配置
```bash
cd backend
# 编辑 .env 文件，添加企业微信机器人 Webhook URL
WECOM_WEBHOOK_URL=https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY_HERE
```

#### GitHub 环境配置（用于 CI/CD）
1. 打开 GitHub 仓库 → Settings → Secrets and variables → Actions
2. 点击 "New repository secret"
3. 名称：`WECOM_WEBHOOK_URL`
4. 值：`https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY_HERE`
5. 保存设置

---

## 🔄 更换设备后的同步

### 从旧设备迁移到新设备

1. **旧设备操作**：
   ```bash
   cd c:\Codes\AzurePerformanceMonitor
   git add .
   git commit -m "完成功能开发，准备换机"
   git push origin master
   ```

2. **新设备操作**：
   ```bash
   git clone https://github.com/fsyinghua/AzurePerformanceMonitor.git
   cd AzurePerformanceMonitor
   # 安装依赖
   cd backend && npm install
   cd ../frontend && npm install
   # 创建和配置 .env 文件
   cd ../backend
   copy .env.example .env
   # 编辑 .env 添加必要配置
   ```

### 定期同步
当从另一台电脑切换回原电脑时：
```bash
cd c:\Codes\AzurePerformanceMonitor

# 更新本地仓库到最新状态
git pull origin master

# 重新安装依赖（如果有新的包）
cd backend && npm install
cd ../frontend && npm install

# 重启服务
npm run dev
```

---

## 📌 CI/CD 自动化配置

项目已集成 GitHub Actions 自动化工作流：

### 工作流功能
- 代码推送到 `main`/`master`/`develop` 分支时自动构建
- Pull Request 创建时触发构建
- 构建完成后自动发送企业微信通知
- 构建状态和结果实时推送

### 配置方法
1. 在 GitHub 仓库中添加 `WECOM_WEBHOOK_URL` 密钥
2. 确保 `.github/workflows/ci-cd.yml` 文件存在
3. 推送代码时自动触发工作流

---

## 🚨 关键提醒

1. **敏感信息保护**：
   - 永远不要将 `.env` 文件提交到 GitHub
   - 使用 GitHub Secrets 存储敏感信息
   - 企业微信 Webhook URL 等配置要妥善保管

2. **依赖管理**：
   - 不同设备间需要重新安装 npm 依赖
   - 确保 Node.js 版本一致（建议 18+）

3. **同步注意事项**：
   - 始终在推送前 pull 最新代码
   - 遇到冲突及时解决
   - 定期查看 git log

4. **服务端口冲突**：
   - 如果 3000 端口被占用，使用以下命令终止占用进程
   ```bash
   # Windows
   $processId = (Get-NetTCPConnection -LocalPort 3000 -ErrorAction Stop).OwningProcess
   taskkill /PID $processId /F
   ```

---

## 🤝 问题解决

- **克隆错误**: 检查网络连接，确保 GitHub 访问正常
- **依赖安装失败**: 尝试使用 `npm cache clean --force` 清理缓存后重试
- **服务启动失败**: 检查端口占用、环境变量配置等
- **Trae AI 上下文丢失**: 导入 `TRAE_AI_CONTEXT.md` 文件

---

遵循此指南，您可以轻松在不同设备间无缝切换开发环境，保持项目的最新状态，并利用企业微信通知和 CI/CD 自动化提高开发效率。